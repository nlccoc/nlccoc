/* global nlccmgmtapp, gon, Layout, $ */

nlccmgmtapp.controller('mgmtCtrl', ['$scope', '$rootScope', 'settings', function($scope, $rootScope, settings){
  console.log('Mgmt Controller');
  //console.log(gon.current_mgmt);
  $scope.current_mgmt = gon.current_mgmt;
  $scope.fullHeight = '700px';
  // set default layout mode
	$rootScope.settings.layout.pageContentWhite = true;
  $rootScope.settings.layout.pageBodySolid = false;
  $rootScope.settings.layout.pageSidebarClosed = false;
}]);

/* Setup Layout Part - Header */
nlccmgmtapp.controller('headerController', ['$scope', function($scope) {
  console.log("Header Controller")
  $scope.$on('$includeContentLoaded', function() {
    Layout.initHeader(); // init header
  });
}]);
nlccmgmtapp.controller('sidebarController', ['$scope', function($scope) {
  console.log("Siderbar Controller");
  $scope.$on('$includeContentLoaded', function() {
    Layout.initSidebar();
  });
}]);

nlccmgmtapp.controller('quicksidebarController', ['$scope', function($scope) {
  console.log("quicksidebarController Controller");
  $scope.$on('$includeContentLoaded', function() {
    setTimeout(function(){
      QuickSidebar.init(); // init quick sidebar        
    }, 2000)
  });
}]);

nlccmgmtapp.controller('mediaVideoCtrl', 
['$scope', '$timeout', 'mvideoFactory', '$uibModal', 
function($scope, $timeout, mvideoFactory, $uibModal) {
  console.log("mediaVideoCtrl Controller");
  $scope.animationsEnabled = true;
  $scope.newvideo={};
  $scope.newvideo.title='';
  $scope.newvideo.date='';
  $scope.newvideo.path='';
  $scope.newvideo.desc='';
  $scope.getMonth = function(date) {
    var monthNames = [
      "Jan", "Feb", "Mar",
      "Apr", "May", "Jun", "Jul",
      "Aug", "Sep", "Oct",
      "Nov", "Dec"
    ];
    var d = new Date(date);
    //console.log('get month');
    return monthNames[d.getMonth()]
  }
  
  $scope.getDay = function(date) {
    var d = new Date(date);
    //console.log(date);
    return d.getDate()+1;
  }
  
  $scope.createMVideo = function(mvideo){
    console.log(mvideo)
    mvideoFactory.createMVideo(mvideo).then(function(data){
      $scope.mvideos.push(data);
      $scope.hideform();
      console.log("Success create a Media");
    });
  }
  
  $scope.deleteMVideo = function(mvideo){
    console.log("DeleteMVideo");
    var modalInstance = $uibModal.open({
      animation: $scope.animationsEnabled,
      templateUrl: 'myModalContent.html',
      controller: 'modalDeleteMvideoCtrl',
      resolve: {
        mvideo: function () {
          return mvideo;
        }
      }
    });
    
    modalInstance.result.then(function (result) {
      console.log(result);
      if(result == 0) {
        var idx = 0;
        for(idx=0; idx<$scope.mvideos.length; idx++){
          if (mvideo.id == $scope.mvideos[idx].id){
            $scope.mvideos.splice(idx, 1);
            return;
          }
        }
      }
    });
  
  }
  
  $scope.showform = function() {
    $('#newEventForm').slideDown(400);
  }
  
  $scope.hideform = function() {
    $('#newEventForm').slideUp(400);
  }
  
  $scope.$on('$viewContentLoaded', function() {
    console.log("view content loaded");
    mvideoFactory.getAllMvideos().then(function(data){
      $scope.mvideos = data;
      //console.log(data);
    });
    $timeout(function(){
     }, 0)
  });
}]);


nlccmgmtapp.controller('modalDeleteMvideoCtrl', 
['$scope', '$uibModalInstance', 'mvideoFactory', 'mvideo', 
function ($scope, $uibModalInstance, mvideoFactory, mvideo) {

  $scope.ok = function () {
    console.log("delete {" + mvideo.id + "}");
    mvideoFactory.deleteMVideo(mvideo.id).then(function(data){
      console.log("Successfully delete the m-video");
    });
    $uibModalInstance.close(0);
  };

  $scope.cancel = function () {
    $uibModalInstance.dismiss('cancel');
  };
}]);